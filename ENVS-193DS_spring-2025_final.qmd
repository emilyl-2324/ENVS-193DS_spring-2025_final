---
title: "ENVS-193DS_spring-2025_final"
name: "Emily Lombardi"
date: 6/9/2025
format: html
editor: visual
toc: true # use this to display a table of contents
execute:
  message: false # use this to make sure messages don't show up
  warning: false # use this to make sure warnings don't show up
---

github repo: https://github.com/emilyl-2324/ENVS-193DS_spring-2025_final.git

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(janitor)
library(dplyr)
library(ggplot2)
library(lubridate)
```

# Problem 1

## a. Transparent statistical methods (8 points)

*What statistical tests did your co-worker use? Clearly connect the test to the part that you are addressing (e.g. “In part 1, they used \_\_\_\_\_\_\_. In part 2, they used \_\_\_\_\_\_\_.”).*

In part 1, they used a person's r test, since the study is finding the correlation between two variables. In part 2, they used an ANOVA test since the study is comparing the means of two or more groups (the test compares the mean nitrogen load from 5 different sources).

## b. More information needed (8 points)

*The test in part 2 seems familiar to you, but you think there’s more that your co-worker needs to do to provide more context for the results. List 2 additional tests and/or pieces of information that should be included, and explain why those tests and/or pieces of information would add useful additional context.*

*Be specific and use variables and/or statistics from the example.* 

One additional test is a test for normality, since ANOVA assumes the data is normally distributed. This can be done through a shapiro-wilk test for each of the sources of nitrogen load (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands). If test-statistics is close to 1, then the sample is normally distributed and if the sample doesn't equal 1, then the sample is not normally distributed.

Another test that should be done is the f-test, which tests for significance between groups, where the f-statistic is a ratio of two variances: the ms (mean square) among the group and the ms within the group. If the ms among groups is significantly larger than ms within groups, the f-stat is large and the null hypothesis should be rejected.

possible tests: significance level. f-statistic. post hocs test. effective size.

## c. Suggestions for rewriting (20 points)

*In 1-3 sentences, write new research statements to include relevant components from parts a-b and a full test summary in parentheses to be transparent about the statistical method.*

*Be sure that your rewritten statements clearly delineate the biological narrative from the statistical summary. See lecture and workshop for examples of writing.*

*Note that your co-worker didn’t include any information about the test statistic, distribution, etc., and that you only know the p-value. For any part that you do not know, list that part with text. For example, you could write something like: “… r = correlation coefficient, p = 0.03, a = significance level …”*

*1) We rejected the null hypothesis that there is no correlation between distance from headwater (km) and annual total nitrogen load (kg year-1) (p = 0.03).*

We found a specific type of relationship (Pearson's r = correlation coefficient, p = 0.03, a = significance level) between the distance from headwaters (in km) and the annual total nitrogen load (kg/year), where headwaters distance significantly predicted/had no correlation with annual total nitrogen load.

template: We found a strong negative (Pearson's r = -0.94) relationship between soil compaction and root length, where soil compaction significantly predicted root length

*2) We rejected the null hypothesis that there is no difference in average nitrogen load (kg year-1) between sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands) (p = 0.02).*

template: (one-way ANOVA, F(among groups df, within groups df) = Fstatistic, p-value, alpha) writing ab anovas: p381 summary template: p382

We found an effective size (n\^2 = effective size) between sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands) in mean nitrogen load (in kg/year) (F-test, F(among groups df, within groups df) = f-statistic, p = 0.02, a = significance level)

We determined the group variances (F-test, F(among groups df, within groups df) = f-statistic, p = 0.02, a = significance level) of the average nitrogen load (in kg/year) between different sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands).

# Problem 2. Data visualization (36 points)

## a.

```{r}
sst <- read_csv("SST_update2023.csv")

sst_clean <- sst |> 
  mutate(
    date = ymd(date),  # ensure date is in Date format
    year = year(date),
    month = month(date)
  ) |> 
  mutate(year = as_factor(year)) |> 
  filter(year %in% c("2018", "2019", "2020", "2021", "2022", "2023")) |> 
  group_by(year, month) |> 
  summarize(mean_monthly_sst = mean(temp, na.rm = TRUE), .groups = "drop") |> 
  mutate(month = month(month, label = TRUE, abbr = FALSE))

slice_sample(sst_clean, n = 5)
str(sst_clean)
```

## b

```{r}
sst_clean_abbr <- sst_clean |> 
  mutate(month = case_when(
    month == "January" ~ "Jan",
    month == "February" ~ "Feb",
    month == "March" ~ "Mar",
    month == "April" ~ "Apr",
    month == "May" ~ "May",
    month == "June" ~ "Jun",
    month == "July" ~ "Jul",
    month == "August" ~ "Aug",
    month == "September" ~ "Sep",
    month == "October" ~ "Oct",
    month == "November" ~ "Nov",
    month == "December" ~ "Dec",
    TRUE ~ month
  )) |> 
  mutate(month = fct_relevel(month, "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
```

```{r}
ggplot(data = sst_clean_abbr, 
  aes(x = month,
      y = mean_monthly_sst,
      color = year,
      group = year))+
  geom_point() +
  geom_line(size = 0.7) + 
  labs(x = "Month",
       y = "Mean Monthly Sea Surface Temperature (°C)"
  ) +
  theme(panel.border = element_rect(color = "black", fill = NA, linewidth = 0.7)) +
#manually assign color to each water year  
 scale_color_manual(values = c(
  "2018" = "#99d8c9", 
  "2019" = "#66c2a4", 
  "2020" = "#41ae76", 
  "2021" = "#238b45", 
  "2022" = "#006d2c", 
  "2023" = "#00441b")
) + 
  theme(panel.background = element_rect(color = "white", fill = "white"), #white panel background 
    legend.position = c(0.11, 0.73), #legend position to top right 
    plot.title.position = "plot") #align title with plot border 
```
