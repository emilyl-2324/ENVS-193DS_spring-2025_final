---
title: "ENVS-193DS_spring-2025_final"
name: "Emily Lombardi"
date: 6/9/2025
format: html
editor: visual
toc: true # use this to display a table of contents
execute:
  message: false # use this to make sure messages don't show up
  warning: false # use this to make sure warnings don't show up
---

github repo: https://github.com/emilyl-2324/ENVS-193DS_spring-2025_final.git

```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(janitor)
library(dplyr)
library(ggplot2)
library(lubridate)
library(DHARMa)
```

# Problem 1

## a. Transparent statistical methods (8 points)

*What statistical tests did your co-worker use? Clearly connect the test to the part that you are addressing (e.g. “In part 1, they used \_\_\_\_\_\_\_. In part 2, they used \_\_\_\_\_\_\_.”).*

In part 1, they used a person's r test, since the study is finding the correlation between two variables. In part 2, they used an ANOVA test since the study is comparing the means of two or more groups (the test compares the mean nitrogen load from 5 different sources).

## b. More information needed (8 points)

*The test in part 2 seems familiar to you, but you think there’s more that your co-worker needs to do to provide more context for the results. List 2 additional tests and/or pieces of information that should be included, and explain why those tests and/or pieces of information would add useful additional context.*

*Be specific and use variables and/or statistics from the example.* 

One additional test is a test for normality, since ANOVA assumes the data is normally distributed. This can be done through a shapiro-wilk test for each of the sources of nitrogen load (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands). If test-statistics is close to 1, then the sample is normally distributed and if the sample doesn't equal 1, then the sample is not normally distributed.

Another test that should be done is the f-test, which tests for significance between groups, where the f-statistic is a ratio of two variances: the ms (mean square) among the group and the ms within the group. If the ms among groups is significantly larger than ms within groups, the f-stat is large and the null hypothesis should be rejected.

possible tests: significance level. f-statistic. post hocs test. effective size.

## c. Suggestions for rewriting (20 points)

*In 1-3 sentences, write new research statements to include relevant components from parts a-b and a full test summary in parentheses to be transparent about the statistical method.*

*Be sure that your rewritten statements clearly delineate the biological narrative from the statistical summary. See lecture and workshop for examples of writing.*

*Note that your co-worker didn’t include any information about the test statistic, distribution, etc., and that you only know the p-value. For any part that you do not know, list that part with text. For example, you could write something like: “… r = correlation coefficient, p = 0.03, a = significance level …”*

*1) We rejected the null hypothesis that there is no correlation between distance from headwater (km) and annual total nitrogen load (kg year-1) (p = 0.03).*

We found a specific type of relationship (Pearson's r = correlation coefficient, p = 0.03, a = significance level) between the distance from headwaters (in km) and the annual total nitrogen load (kg/year), where headwaters distance significantly predicted/had no correlation with annual total nitrogen load.

template: We found a strong negative (Pearson's r = -0.94) relationship between soil compaction and root length, where soil compaction significantly predicted root length

*2) We rejected the null hypothesis that there is no difference in average nitrogen load (kg year-1) between sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands) (p = 0.02).*

template: (one-way ANOVA, F(among groups df, within groups df) = Fstatistic, p-value, alpha) writing ab anovas: p381 summary template: p382

We found an effective size (n\^2 = effective size) between sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands) in mean nitrogen load (in kg/year) (F-test, F(among groups df, within groups df) = f-statistic, p = 0.02, a = significance level)

We determined the group variances (F-test, F(among groups df, within groups df) = f-statistic, p = 0.02, a = significance level) of the average nitrogen load (in kg/year) between different sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands).

# Problem 2. Data visualization (36 points)

## a.

```{r}
sst <- read_csv("SST_update2023.csv")

sst_clean <- sst |> 
  mutate(
    date = ymd(date),  # ensure date is in Date format
    year = year(date),
    month = month(date)
  ) |> 
  mutate(year = as_factor(year)) |> 
  filter(year %in% c("2018", "2019", "2020", "2021", "2022", "2023")) |> 
  group_by(year, month) |> 
  summarize(mean_monthly_sst = mean(temp, na.rm = TRUE), .groups = "drop") |> 
  mutate(month = month(month, label = TRUE, abbr = FALSE))

slice_sample(sst_clean, n = 5)
str(sst_clean)
```

## b

```{r}
sst_clean_abbr <- sst_clean |> 
  mutate(month = case_when(
    month == "January" ~ "Jan",
    month == "February" ~ "Feb",
    month == "March" ~ "Mar",
    month == "April" ~ "Apr",
    month == "May" ~ "May",
    month == "June" ~ "Jun",
    month == "July" ~ "Jul",
    month == "August" ~ "Aug",
    month == "September" ~ "Sep",
    month == "October" ~ "Oct",
    month == "November" ~ "Nov",
    month == "December" ~ "Dec",
    TRUE ~ month
  )) |> 
  mutate(month = fct_relevel(month, "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
```

```{r}
ggplot(data = sst_clean_abbr, 
  aes(x = month,
      y = mean_monthly_sst,
      color = year,
      group = year))+
  geom_point() +
  geom_line(size = 0.7) + 
  labs(x = "Month",
       y = "Mean Monthly Sea Surface Temperature (°C)"
  ) +
  theme(panel.border = element_rect(color = "black", fill = NA, linewidth = 0.7)) +
#manually assign color to each water year  
 scale_color_manual(values = c(
  "2018" = "#99d8c9", 
  "2019" = "#66c2a4", 
  "2020" = "#41ae76", 
  "2021" = "#238b45", 
  "2022" = "#006d2c", 
  "2023" = "#00441b")
) + 
  theme(panel.background = element_rect(color = "white", fill = "white"), #white panel background 
    legend.position = c(0.11, 0.73), #legend position to top right 
    plot.title.position = "plot") #align title with plot border 
```

# Problem 3: 
## a. Response variable (2 points)
*In 1-2 sentences, explain what the 1s and 0s mean in this data set biologically.*

The 1s mean the nest is being occupied by a bird species and the 0s mean the nest isn't occupied by a bird species.

## b. Purpose of study (2 points)
*The authors compare nest box occupancy between 3 species: Swift Parrots, Common Starlings, and Tree Martins. In 1-2 sentences, explain the main difference between Swift Parrots and the other two species in the context of this study.*

The purpose of the study is to find the relationship between the nest position (distance from forest edge) and non-target species exploitation of target-species nest boxes. The swift parrots are the target species and the common starlings and tree martins are non-target species. 

## c. Difference in “seasons” (2 points)
*The authors compare two years (that they refer to as “seasons”). In 1-2 sentences, define what those years/seasons are, and explain how they differ in the context of this study.*

The authors compare the data between 2 seasons, which refers to the swift parrot breeding season (during summer) in 2016 and 2019. 

## d. table: 
*Make a table of all the models you will need to run. You will run 4 models: a null model, a saturated model, and two other models with different combinations of predictors. Your table should have 4 columns: (1) model number, (2) season, (3) distance to forest edge, and (4) model description.*

| Model number | season | distance to forest edge | model description           |  
|:------------:|:------:|:-----------------------:|:---------------------------:|
| 1            |        |                         | null model (no predictors)  |
| 2            |  X     |       X                 | all predictors (full model) | 
| 3            |  X     |       X                 | season only                 |   
| 4            |  X     |                         | distance only               | 

## e. Run the models (8 points)
*Write your code to run all your models. Do not display any output.*
```{r}
nest_data <- read_csv("occdist.csv")
nest_data_clean <- nest_data |> #make an object called nest_clean
  clean_names() |> #clean the names to get rid of "."
  mutate(season = as.factor(season)) #make box_occupant a factor w 4 levels
```

```{r}

model1 <-  glm(sp ~ 1, #null model #running a generalized linear model because the data is continuous against binary
                   data = nest_data_clean,
                   family = "binomial") #specifies a binary response variable (Swift Parrot occupancy in the nest boxes)

model2 <-  glm(sp ~ season + edge_distance, #saturated model (season and distance)
             data = nest_data_clean,
             family = "binomial")

model3 <- glm(sp ~ season, #season only
            data = nest_data_clean,
            family = "binomial")

model4 <-  glm(sp ~ edge_distance, #distance only
             data = nest_data_clean,
             family = "binomial")

```

## f. Check the diagnostics

```{r}
# Simulate residuals for each model
residual1 <- simulateResiduals(model1) #null
residual2 <- simulateResiduals(model2) #saturated 
residual3 <- simulateResiduals(model3) #season 
residual4 <- simulateResiduals(model4) #distance 

par(mfrow = c(2, 2)) #layout of plot

#plot residuals

plot(residual1, main = "Model 1, Null")
```

```{r}
plot(residual2, main = "Model 2, Saturated")
```

```{r}
plot(residual3, main = "Model 3, year only")
```

```{r}
plot(residual4, main = "Model 4, distance only")
```
